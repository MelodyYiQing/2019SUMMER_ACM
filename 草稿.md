```cpp
#include<bits/stdc++.h>
using namespace std;
#define rep(i,a,b) for(int i=(a);i<=(b);++i)
#define dep(i,a,b) for(int i=(a);i>=(b);--i)
#define pb push_back
typedef long long ll;
const int maxn=(int)1e6+100;
int n,m,a[maxn],cnt[maxn];
struct node{
	int t,x;
	bool operator<(const node &b)const{return t<b.t;}
}p[maxn];
void solve(){
	rep(i,1,n) scanf("%d%d",&p[i].t,&p[i].x);
	sort(p+1,p+1+n);
	rep(i,1,m) scanf("%d",&a[i]),cnt[i]=0;
	int pos=1,op=0;
	ll has=0,need=0,ans=0;
	rep(t,1,p[n].t){
		if(has>op||p[pos].t==t)	op++;
		while(need&&op) op--,has--,need--;
		while(pos<=n&&p[pos].t==t){
			int now=p[pos++].x;
			cnt[now]++; has++;
			if(cnt[now]>a[now]){
				if(op) op--;
				else need++;
				cnt[now]--;
			}
		}
		ans+=need;
	}
	if(need) ans+=need*(need-1)/2;
	printf("%lld\n",ans);
}
int main(){
	scanf("%d%d",&n,&m); solve();
}
```cpp
